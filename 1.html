<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steam游戏下载工具 - 陈真研</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1b2838 0%, #2a475e 100%);
            color: #c7d5e0;
            min-height: 100vh;
            padding: 20px;
            background-image: url('https://cdn.akamai.steamstatic.com/store/home/store_main_english.jpg');
            background-size: cover;
            background-attachment: fixed;
            backdrop-filter: blur(5px);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(27, 40, 56, 0.85);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(102, 192, 244, 0.2);
        }
        
        header {
            background: linear-gradient(90deg, #171a21 0%, #1b2838 100%);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #66c0f4;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo i {
            font-size: 2.5rem;
            color: #66c0f4;
        }
        
        h1 {
            color: #ffffff;
            font-size: 2.2rem;
            font-weight: 300;
        }
        
        .suggestion {
            font-size: 1rem;
            margin-top: 5px;
        }
        
        .suggestion a {
            color: #66c0f4;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s;
        }
        
        .suggestion a:hover {
            color: #8cd5ff;
            text-decoration: underline;
        }
        
        .user-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #66c0f4;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 20px;
        }
        
        @media (max-width: 1100px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .search-section {
            background: rgba(42, 71, 94, 0.6);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid rgba(102, 192, 244, 0.3);
            position: relative;
        }
        
        .section-title {
            color: #66c0f4;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 1px solid #66c0f4;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            font-size: 1.2rem;
        }
        
        .search-box {
            display: flex;
            margin-bottom: 20px;
            position: relative;
        }
        
        .search-box input {
            flex: 1;
            padding: 12px 15px;
            border: none;
            border-radius: 3px 0 0 3px;
            background: rgba(23, 26, 33, 0.8);
            color: white;
            font-size: 1rem;
            border: 1px solid #3c5a78;
        }
        
        .search-box button {
            padding: 12px 20px;
            border: none;
            background: linear-gradient(90deg, #47bfff 0%, #4f6bed 100%);
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .search-box button:hover {
            background: linear-gradient(90deg, #3aa3e6 0%, #435bd4 100%);
            transform: translateY(-2px);
        }
        
        .steamdb-btn {
            margin-left: 10px;
            padding: 12px 15px;
            border: none;
            border-radius: 3px;
            background: linear-gradient(90deg, #ff6b35 0%, #ff8e35 100%);
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .steamdb-btn:hover {
            background: linear-gradient(90deg, #e55a2b 0%, #e57c2b 100%);
            transform: translateY(-2px);
        }
        
        .search-options {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .price-filter {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }
        
        .price-filter select {
            padding: 8px 12px;
            border-radius: 3px;
            background: rgba(23, 26, 33, 0.8);
            color: white;
            border: 1px solid #3c5a78;
        }
        
        .sort-options {
            display: flex;
            gap: 5px;
        }
        
        .sort-btn {
            padding: 8px 12px;
            background: rgba(102, 192, 244, 0.2);
            border: 1px solid #66c0f4;
            color: #66c0f4;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
        }
        
        .sort-btn.active {
            background: rgba(102, 192, 244, 0.4);
        }
        
        .sort-btn:hover {
            background: rgba(102, 192, 244, 0.3);
        }
        
        .suggestions-box {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(23, 26, 33, 0.95);
            border: 1px solid #3c5a78;
            border-top: none;
            border-radius: 0 0 3px 3px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            display: none;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .suggestion-item {
            padding: 10px 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }
        
        .suggestion-item:hover, .suggestion-item.active {
            background: rgba(102, 192, 244, 0.2);
        }
        
        .suggestion-game {
            font-weight: bold;
        }
        
        .suggestion-appid {
            color: #66c0f4;
            font-size: 0.8rem;
        }
        
        .suggestion-price {
            color: #5c7e10;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .download-section {
            display: flex;
            margin-top: 20px;
        }
        
        .download-section input {
            flex: 1;
            padding: 12px 15px;
            border: none;
            border-radius: 3px 0 0 3px;
            background: rgba(23, 26, 33, 0.8);
            color: white;
            font-size: 1rem;
            border: 1px solid #3c5a78;
        }
        
        .download-section button {
            padding: 12px 20px;
            border: none;
            border-radius: 0 3px 3px 0;
            background: linear-gradient(90deg, #5cd85a 0%, #3ca73a 100%);
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .download-section button:hover {
            background: linear-gradient(90deg, #4ac248 0%, #2e8f2c 100%);
            transform: translateY(-2px);
        }
        
        .results {
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }
        
        .result-item {
            padding: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .result-item:hover {
            background: rgba(102, 192, 244, 0.1);
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .game-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }
        
        .game-icon {
            width: 40px;
            height: 40px;
            background: #66c0f4;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8rem;
        }
        
        .game-details {
            flex: 1;
        }
        
        .game-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .app-id {
            color: #66c0f4;
            font-size: 0.9rem;
        }
        
        .price-info {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
        }
        
        .price-tag {
            background: #5c7e10;
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .price-free {
            background: #66c0f4;
        }
        
        .price-discount {
            background: #a34c25;
            font-size: 0.8rem;
            padding: 2px 6px;
            border-radius: 2px;
        }
        
        .rankings-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .rankings {
            background: rgba(42, 71, 94, 0.6);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid rgba(102, 192, 244, 0.3);
        }
        
        .rankings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .refresh-btn {
            background: rgba(102, 192, 244, 0.2);
            border: 1px solid #66c0f4;
            color: #66c0f4;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
        }
        
        .refresh-btn:hover {
            background: rgba(102, 192, 244, 0.4);
        }
        
        .rankings-list {
            list-style-type: none;
        }
        
        .rankings-list li {
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: color 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .rankings-list li:hover {
            color: #66c0f4;
        }
        
        .rankings-list li:last-child {
            border-bottom: none;
        }
        
        .rank-number {
            font-weight: bold;
            color: #66c0f4;
            margin-right: 10px;
        }
        
        .price-change {
            font-size: 0.8rem;
            padding: 2px 5px;
            border-radius: 3px;
        }
        
        .price-up {
            background: rgba(92, 126, 16, 0.3);
            color: #a3cf8b;
        }
        
        .price-down {
            background: rgba(163, 76, 37, 0.3);
            color: #ff9b7b;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            background: rgba(23, 26, 33, 0.8);
            border-top: 1px solid rgba(102, 192, 244, 0.3);
            margin-top: 20px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: #1b2838;
            padding: 30px;
            border-radius: 10px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.5);
            border: 2px solid #66c0f4;
            backdrop-filter: blur(10px);
        }
        
        .modal h2 {
            color: #66c0f4;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .modal p {
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .modal button {
            padding: 10px 20px;
            background: #66c0f4;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
            display: block;
            margin: 0 auto;
            transition: background 0.3s;
        }
        
        .modal button:hover {
            background: #4a9cd4;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #66c0f4;
        }
        
        .error {
            color: #ff6b6b;
            padding: 10px;
            text-align: center;
        }
        
        .status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 3px;
            text-align: center;
            display: none;
        }
        
        .status.success {
            background: rgba(76, 107, 34, 0.3);
            color: #a3cf8b;
            display: block;
        }
        
        .status.error {
            background: rgba(163, 76, 37, 0.3);
            color: #ff9b7b;
            display: block;
        }
        
        .chart-container {
            height: 100px;
            margin-top: 10px;
            background: rgba(23, 26, 33, 0.5);
            border-radius: 3px;
            padding: 5px;
            position: relative;
            overflow: hidden;
        }
        
        .price-chart {
            display: flex;
            align-items: flex-end;
            height: 100%;
            gap: 2px;
        }
        
        .chart-bar {
            flex: 1;
            background: #66c0f4;
            border-radius: 2px 2px 0 0;
            transition: height 0.5s;
        }
        
        .chart-label {
            position: absolute;
            bottom: 5px;
            left: 5px;
            font-size: 0.7rem;
            color: #8f98a0;
        }
        
        .trend-prediction {
            font-size: 0.8rem;
            margin-top: 5px;
            text-align: center;
        }
        
        .trend-up {
            color: #a3cf8b;
        }
        
        .trend-down {
            color: #ff9b7b;
        }
        
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 0 5px;
        }
        
        .results-count {
            font-size: 0.9rem;
            color: #8f98a0;
        }
    </style>
</head>
<body>
    <!-- 免责声明弹窗 -->
    <div id="disclaimerModal" class="modal">
        <div class="modal-content">
            <h2>免责声明</h2>
            <p>本软件基于ManifestHub仓库开发，仅供学习交流使用。</p>
            <p>请勿将本软件用于商业用途或侵犯版权的行为。</p>
            <p>使用本软件产生的任何后果由使用者自行承担。</p>
            <button id="agreeBtn">同意并继续</button>
        </div>
    </div>

    <div class="container">
        <header>
            <div class="logo">
                <i class="fab fa-steam"></i>
                <div>
                    <h1>Steam游戏下载工具</h1>
                    <p class="suggestion">本软件建议配合<a href="https://www.steamtools.net/" target="_blank">steamtools</a>食用更佳</p>
                </div>
            </div>
            <div class="user-section">
                <div class="user-avatar">CZ</div>
                <span>陈真研</span>
            </div>
        </header>
        
        <div class="main-content">
            <section class="search-section">
                <h2 class="section-title"><i class="fas fa-search"></i> 游戏搜索与下载</h2>
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="输入游戏名称进行搜索..." autocomplete="off">
                    <button id="searchBtn">搜索</button>
                    <button class="steamdb-btn" id="steamdbBtn">SteamDB查找</button>
                    <!-- 联想搜索建议框 -->
                    <div class="suggestions-box" id="suggestionsBox"></div>
                </div>
                
                <div class="search-options">
                    <div class="price-filter">
                        <label for="priceRange">价格筛选:</label>
                        <select id="priceRange">
                            <option value="all">全部价格</option>
                            <option value="free">免费游戏</option>
                            <option value="0-50">0-50元</option>
                            <option value="50-100">50-100元</option>
                            <option value="100-200">100-200元</option>
                            <option value="200+">200元以上</option>
                        </select>
                    </div>
                    <div class="sort-options">
                        <button class="sort-btn" data-sort="name">名称排序</button>
                        <button class="sort-btn" data-sort="price">价格排序</button>
                    </div>
                </div>
                
                <div class="results" id="results">
                    <div class="results-header">
                        <div class="results-count" id="resultsCount">找到 0 个游戏</div>
                    </div>
                    <div class="loading" id="loading" style="display: none;">搜索中...</div>
                    <div class="error" id="error" style="display: none;"></div>
                    <!-- 搜索结果将在这里显示 -->
                </div>
                
                <div class="download-section">
                    <input type="text" id="appIdInput" placeholder="输入或选择App ID">
                    <button id="downloadBtn">直接下载</button>
                </div>
                
                <div class="status" id="status"></div>
            </section>
            
            <section class="search-section">
                <h2 class="section-title"><i class="fas fa-chart-line"></i> 游戏价格趋势</h2>
                <div class="chart-container">
                    <div class="price-chart" id="priceChart">
                        <!-- 价格图表将在这里显示 -->
                    </div>
                    <div class="chart-label">近30天价格趋势</div>
                </div>
                <div class="trend-prediction" id="trendPrediction">
                    <!-- 趋势预测将在这里显示 -->
                </div>
            </section>
        </div>
        
        <div class="rankings-section">
            <div class="rankings">
                <div class="rankings-header">
                    <h3 class="section-title"><i class="fas fa-star"></i> 推荐榜</h3>
                    <button class="refresh-btn" id="refreshRecs"><i class="fas fa-sync-alt"></i> 刷新</button>
                </div>
                <ul class="rankings-list" id="recommendations">
                    <!-- 推荐榜内容将通过JavaScript动态加载 -->
                </ul>
            </div>
            
            <div class="rankings">
                <div class="rankings-header">
                    <h3 class="section-title"><i class="fas fa-fire"></i> 热搜榜</h3>
                    <button class="refresh-btn" id="refreshHot"><i class="fas fa-sync-alt"></i> 刷新</button>
                </div>
                <ul class="rankings-list" id="hotSearches">
                    <!-- 热搜榜内容将通过JavaScript动态加载 -->
                </ul>
            </div>
        </div>
        
        <footer>
            <p>开发者: 陈真研</p>
            <p>基于ManifestHub仓库开发，仅供学习交流</p>
        </footer>
    </div>

    <script>
        // 游戏数据库（模拟数据）
        const gameDatabase = [
            { name: "艾尔登法环", appid: "1245620", price: 298, trend: "up", discount: 0 },
            { name: "赛博朋克2077", appid: "1091500", price: 298, trend: "down", discount: 20 },
            { name: "只狼：影逝二度", appid: "814380", price: 268, trend: "stable", discount: 10 },
            { name: "霍格沃茨之遗", appid: "990080", price: 298, trend: "up", discount: 0 },
            { name: "荒野大镖客2", appid: "1174180", price: 249, trend: "down", discount: 30 },
            { name: "怪物猎人：世界", appid: "582010", price: 203, trend: "stable", discount: 15 },
            { name: "巫师3：狂猎", appid: "292030", price: 127, trend: "down", discount: 50 },
            { name: "星露谷物语", appid: "413150", price: 48, trend: "stable", discount: 0 },
            { name: "哈迪斯", appid: "1145360", price: 80, trend: "up", discount: 25 },
            { name: "空洞骑士", appid: "367520", price: 48, trend: "stable", discount: 0 },
            { name: "黑神话：悟空", appid: "2358720", price: 298, trend: "up", discount: 0 },
            { name: "绝地求生", appid: "578080", price: 98, trend: "down", discount: 0 },
            { name: "CS:GO", appid: "730", price: 0, trend: "stable", discount: 0 },
            { name: "Apex英雄", appid: "1172470", price: 0, trend: "up", discount: 0 },
            { name: "Dota 2", appid: "570", price: 0, trend: "stable", discount: 0 },
            { name: "命运2", appid: "1085660", price: 0, trend: "down", discount: 0 },
            { name: "彩虹六号：围攻", appid: "359550", price: 88, trend: "up", discount: 40 },
            { name: "侠盗猎车手5", appid: "271590", price: 119, trend: "stable", discount: 0 },
            { name: "上古卷轴5：天际", appid: "72850", price: 129, trend: "down", discount: 60 },
            { name: "我的世界", appid: "498240", price: 165, trend: "stable", discount: 0 }
        ];

        // 当前排序方式
        let currentSort = 'name';
        let sortAscending = true;

        // 显示免责声明弹窗
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('disclaimerModal').style.display = 'flex';
            loadRankings();
            updatePriceChart();
            
            // 初始化联想搜索功能
            initSuggestions();
            
            // 初始化排序按钮
            initSortButtons();
            
            // 初始化价格筛选
            initPriceFilter();
        });
        
        // 同意按钮点击事件
        document.getElementById('agreeBtn').addEventListener('click', function() {
            document.getElementById('disclaimerModal').style.display = 'none';
        });
        
        // 搜索按钮点击事件
        document.getElementById('searchBtn').addEventListener('click', searchGame);
        
        // 回车键搜索
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchGame();
            }
        });
        
        // SteamDB按钮点击事件
        document.getElementById('steamdbBtn').addEventListener('click', function() {
            const query = document.getElementById('searchInput').value.trim();
            if (query) {
                window.open(`https://steamdb.info/search/?a=app&q=${encodeURIComponent(query)}`, '_blank');
            } else {
                window.open('https://steamdb.info/', '_blank');
            }
        });
        
        // 下载按钮点击事件
        document.getElementById('downloadBtn').addEventListener('click', function() {
            const appId = document.getElementById('appIdInput').value.trim();
            if (!appId) {
                showStatus('请输入有效的App ID', 'error');
                return;
            }
            
            // 构建下载链接
            const url = `https://github.com/SteamAutoCracks/ManifestHub/archive/refs/heads/${appId}.zip`;
            
            // 直接打开下载链接（浏览器会处理下载）
            const downloadWindow = window.open(url, '_blank');
            
            if (downloadWindow) {
                showStatus(`下载已开始！App ID: ${appId}`, 'success');
            } else {
                showStatus('下载窗口被阻止，请检查浏览器设置', 'error');
            }
        });
        
        // 刷新推荐榜
        document.getElementById('refreshRecs').addEventListener('click', function() {
            loadRankings('recommendations');
            showStatus('推荐榜已刷新', 'success');
        });
        
        // 刷新热搜榜
        document.getElementById('refreshHot').addEventListener('click', function() {
            loadRankings('hotSearches');
            showStatus('热搜榜已刷新', 'success');
        });
        
        // 初始化联想搜索功能
        function initSuggestions() {
            const searchInput = document.getElementById('searchInput');
            const suggestionsBox = document.getElementById('suggestionsBox');
            
            // 输入事件监听
            searchInput.addEventListener('input', function() {
                const query = this.value.trim();
                
                // 如果查询为空，隐藏建议框
                if (!query) {
                    suggestionsBox.style.display = 'none';
                    return;
                }
                
                // 过滤游戏数据库
                const suggestions = gameDatabase.filter(game => 
                    game.name.toLowerCase().includes(query.toLowerCase())
                ).slice(0, 5); // 只显示前5个结果
                
                // 显示建议框
                if (suggestions.length > 0) {
                    suggestionsBox.innerHTML = '';
                    suggestions.forEach((game, index) => {
                        const suggestionItem = document.createElement('div');
                        suggestionItem.className = 'suggestion-item';
                        suggestionItem.innerHTML = `
                            <span class="suggestion-game">${game.name}</span>
                            <span class="suggestion-price">${game.price === 0 ? '免费' : '¥' + game.price}</span>
                        `;
                        
                        // 点击建议项
                        suggestionItem.addEventListener('click', function() {
                            searchInput.value = game.name;
                            document.getElementById('appIdInput').value = game.appid;
                            suggestionsBox.style.display = 'none';
                            showStatus(`已选择: ${game.name} (${game.appid})`, 'success');
                            updatePriceChart(game);
                        });
                        
                        suggestionsBox.appendChild(suggestionItem);
                    });
                    
                    suggestionsBox.style.display = 'block';
                } else {
                    suggestionsBox.style.display = 'none';
                }
            });
            
            // 键盘导航
            searchInput.addEventListener('keydown', function(e) {
                const suggestions = suggestionsBox.querySelectorAll('.suggestion-item');
                const activeSuggestion = suggestionsBox.querySelector('.suggestion-item.active');
                let activeIndex = -1;
                
                if (activeSuggestion) {
                    activeIndex = Array.from(suggestions).indexOf(activeSuggestion);
                }
                
                // 下箭头
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    
                    if (suggestions.length === 0) return;
                    
                    // 移除当前激活状态
                    if (activeSuggestion) {
                        activeSuggestion.classList.remove('active');
                    }
                    
                    // 计算下一个索引
                    let nextIndex = activeIndex + 1;
                    if (nextIndex >= suggestions.length) {
                        nextIndex = 0;
                    }
                    
                    // 激活下一个建议项
                    suggestions[nextIndex].classList.add('active');
                }
                
                // 上箭头
                if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    
                    if (suggestions.length === 0) return;
                    
                    // 移除当前激活状态
                    if (activeSuggestion) {
                        activeSuggestion.classList.remove('active');
                    }
                    
                    // 计算上一个索引
                    let prevIndex = activeIndex - 1;
                    if (prevIndex < 0) {
                        prevIndex = suggestions.length - 1;
                    }
                    
                    // 激活上一个建议项
                    suggestions[prevIndex].classList.add('active');
                }
                
                // 回车键选择激活的建议项
                if (e.key === 'Enter' && activeSuggestion) {
                    e.preventDefault();
                    activeSuggestion.click();
                }
                
                // ESC键隐藏建议框
                if (e.key === 'Escape') {
                    suggestionsBox.style.display = 'none';
                }
            });
            
            // 点击其他地方隐藏建议框
            document.addEventListener('click', function(e) {
                if (!searchInput.contains(e.target) && !suggestionsBox.contains(e.target)) {
                    suggestionsBox.style.display = 'none';
                }
            });
        }
        
        // 初始化排序按钮
        function initSortButtons() {
            const sortButtons = document.querySelectorAll('.sort-btn');
            
            sortButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const sortType = this.getAttribute('data-sort');
                    
                    // 如果点击的是当前排序方式，切换升序/降序
                    if (sortType === currentSort) {
                        sortAscending = !sortAscending;
                    } else {
                        currentSort = sortType;
                        sortAscending = true;
                    }
                    
                    // 更新按钮状态
                    sortButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 重新搜索（如果有搜索内容）
                    const query = document.getElementById('searchInput').value.trim();
                    if (query) {
                        searchGame();
                    }
                });
            });
        }
        
        // 初始化价格筛选
        function initPriceFilter() {
            const priceRange = document.getElementById('priceRange');
            
            priceRange.addEventListener('change', function() {
                // 重新搜索（如果有搜索内容）
                const query = document.getElementById('searchInput').value.trim();
                if (query) {
                    searchGame();
                }
            });
        }
        
        // 搜索游戏函数
        function searchGame() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) {
                showStatus('请输入游戏名称', 'error');
                return;
            }
            
            // 显示加载中
            document.getElementById('loading').style.display = 'block';
            document.getElementById('error').style.display = 'none';
            hideStatus();
            
            // 清空之前的结果
            const resultsContainer = document.getElementById('results');
            const existingResults = resultsContainer.querySelectorAll('.result-item');
            existingResults.forEach(item => item.remove());
            
            // 隐藏联想搜索建议框
            document.getElementById('suggestionsBox').style.display = 'none';
            
            // 模拟API调用延迟
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
                
                // 在游戏数据库中搜索
                let results = gameDatabase.filter(game => 
                    game.name.toLowerCase().includes(query.toLowerCase())
                );
                
                // 应用价格筛选
                const priceRange = document.getElementById('priceRange').value;
                if (priceRange !== 'all') {
                    results = results.filter(game => {
                        switch(priceRange) {
                            case 'free':
                                return game.price === 0;
                            case '0-50':
                                return game.price > 0 && game.price <= 50;
                            case '50-100':
                                return game.price > 50 && game.price <= 100;
                            case '100-200':
                                return game.price > 100 && game.price <= 200;
                            case '200+':
                                return game.price > 200;
                            default:
                                return true;
                        }
                    });
                }
                
                // 应用排序
                results.sort((a, b) => {
                    let aValue, bValue;
                    
                    if (currentSort === 'name') {
                        aValue = a.name.toLowerCase();
                        bValue = b.name.toLowerCase();
                    } else {
                        aValue = a.price;
                        bValue = b.price;
                    }
                    
                    if (aValue < bValue) return sortAscending ? -1 : 1;
                    if (aValue > bValue) return sortAscending ? 1 : -1;
                    return 0;
                });
                
                // 显示结果数量
                document.getElementById('resultsCount').textContent = `找到 ${results.length} 个游戏`;
                
                // 显示结果
                if (results.length > 0) {
                    results.forEach(game => {
                        const resultItem = document.createElement('div');
                        resultItem.className = 'result-item';
                        
                        // 计算折扣价格
                        const discountPrice = game.discount > 0 ? 
                            Math.round(game.price * (100 - game.discount) / 100) : game.price;
                        
                        resultItem.innerHTML = `
                            <div class="game-info">
                                <div class="game-icon">${game.name.substring(0, 2)}</div>
                                <div class="game-details">
                                    <div class="game-name">${game.name}</div>
                                    <div class="app-id">App ID: ${game.appid}</div>
                                </div>
                            </div>
                            <div class="price-info">
                                ${game.discount > 0 ? 
                                    `<div class="price-tag price-discount">-${game.discount}%</div>
                                     <div class="price-tag">¥${discountPrice}</div>
                                     <div style="text-decoration: line-through; color: #8f98a0; font-size: 0.8rem;">¥${game.price}</div>` :
                                    `<div class="price-tag ${game.price === 0 ? 'price-free' : ''}">${game.price === 0 ? '免费' : '¥' + game.price}</div>`
                                }
                            </div>
                        `;
                        
                        // 点击结果项将App ID填入输入框
                        resultItem.addEventListener('click', function() {
                            document.getElementById('appIdInput').value = game.appid;
                            showStatus(`已选择: ${game.name} (${game.appid})`, 'success');
                            updatePriceChart(game);
                        });
                        
                        resultsContainer.appendChild(resultItem);
                    });
                } else {
                    document.getElementById('error').style.display = 'block';
                    document.getElementById('error').textContent = '未找到相关游戏，请尝试使用SteamDB查找';
                }
            }, 800);
        }
        
        // 加载推荐榜和热搜榜
        function loadRankings(type = 'all') {
            const recommendations = [
                { name: "艾尔登法环", appid: "1245620", price: 298, change: "+5%" },
                { name: "霍格沃茨之遗", appid: "990080", price: 298, change: "+2%" },
                { name: "黑神话：悟空", appid: "2358720", price: 298, change: "+8%" },
                { name: "只狼：影逝二度", appid: "814380", price: 268, change: "-3%" },
                { name: "哈迪斯", appid: "1145360", price: 80, change: "+1%" },
                { name: "怪物猎人：世界", appid: "582010", price: 203, change: "0%" },
                { name: "赛博朋克2077", appid: "1091500", price: 298, change: "-5%" },
                { name: "空洞骑士", appid: "367520", price: 48, change: "0%" },
                { name: "彩虹六号：围攻", appid: "359550", price: 88, change: "+2%" },
                { name: "星露谷物语", appid: "413150", price: 48, change: "0%" }
            ];
            
            const hotSearches = [
                { name: "黑神话：悟空", appid: "2358720", price: 298, change: "+8%" },
                { name: "绝地求生", appid: "578080", price: 98, change: "-2%" },
                { name: "CS:GO", appid: "730", price: 0, change: "0%" },
                { name: "Apex英雄", appid: "1172470", price: 0, change: "+3%" },
                { name: "Dota 2", appid: "570", price: 0, change: "0%" },
                { name: "命运2", appid: "1085660", price: 0, change: "-1%" },
                { name: "侠盗猎车手5", appid: "271590", price: 119, change: "0%" },
                { name: "上古卷轴5：天际", appid: "72850", price: 129, change: "-2%" },
                { name: "我的世界", appid: "498240", price: 165, change: "0%" },
                { name: "荒野大镖客2", appid: "1174180", price: 249, change: "-4%" }
            ];
            
            // 更新推荐榜
            if (type === 'all' || type === 'recommendations') {
                const recList = document.getElementById('recommendations');
                recList.innerHTML = '';
                
                recommendations.forEach((item, index) => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <div>
                            <span class="rank-number">${index + 1}</span>
                            ${item.name}
                        </div>
                        <div>
                            <span class="price-tag">${item.price === 0 ? '免费' : '¥' + item.price}</span>
                            <span class="price-change ${item.change.startsWith('+') ? 'price-up' : item.change.startsWith('-') ? 'price-down' : ''}">${item.change}</span>
                        </div>
                    `;
                    
                    li.addEventListener('click', function() {
                        document.getElementById('appIdInput').value = item.appid;
                        document.getElementById('searchInput').value = item.name;
                        showStatus(`已选择: ${item.name} (${item.appid})`, 'success');
                        
                        const game = gameDatabase.find(g => g.appid === item.appid);
                        if (game) updatePriceChart(game);
                    });
                    
                    recList.appendChild(li);
                });
            }
            
            // 更新热搜榜
            if (type === 'all' || type === 'hotSearches') {
                const hotList = document.getElementById('hotSearches');
                hotList.innerHTML = '';
                
                hotSearches.forEach((item, index) => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <div>
                            <span class="rank-number">${index + 1}</span>
                            ${item.name}
                        </div>
                        <div>
                            <span class="price-tag">${item.price === 0 ? '免费' : '¥' + item.price}</span>
                            <span class="price-change ${item.change.startsWith('+') ? 'price-up' : item.change.startsWith('-') ? 'price-down' : ''}">${item.change}</span>
                        </div>
                    `;
                    
                    li.addEventListener('click', function() {
                        document.getElementById('searchInput').value = item.name;
                        searchGame();
                    });
                    
                    hotList.appendChild(li);
                });
            }
        }
        
        // 更新价格图表
        function updatePriceChart(game = null) {
            const chartContainer = document.getElementById('priceChart');
            chartContainer.innerHTML = '';
            
            // 如果没有指定游戏，使用默认数据
            if (!game) {
                game = { name: "示例游戏", trend: "up" };
            }
            
            // 生成随机价格数据
            const prices = [];
            let basePrice = Math.floor(Math.random() * 200) + 50;
            
            for (let i = 0; i < 30; i++) {
                // 模拟价格波动
                const fluctuation = Math.floor(Math.random() * 20) - 10;
                prices.push(Math.max(10, basePrice + fluctuation));
                basePrice = prices[prices.length - 1];
            }
            
            // 找到最高价格用于缩放
            const maxPrice = Math.max(...prices);
            
            // 创建价格柱状图
            prices.forEach(price => {
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.height = `${(price / maxPrice) * 90}%`;
                chartContainer.appendChild(bar);
            });
            
            // 更新趋势预测
            const trendElement = document.getElementById('trendPrediction');
            const lastPrice = prices[prices.length - 1];
            const prevPrice = prices[prices.length - 7]; // 一周前的价格
            
            let trendText, trendClass;
            if (lastPrice > prevPrice) {
                trendText = `预计${game.name}价格将继续上涨`;
                trendClass = 'trend-up';
            } else if (lastPrice < prevPrice) {
                trendText = `预计${game.name}价格将继续下跌`;
                trendClass = 'trend-down';
            } else {
                trendText = `预计${game.name}价格将保持稳定`;
                trendClass = '';
            }
            
            trendElement.textContent = trendText;
            trendElement.className = `trend-prediction ${trendClass}`;
        }
        
        // 显示状态消息
        function showStatus(message, type) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = 'status ' + type;
        }
        
        // 隐藏状态消息
        function hideStatus() {
            const statusEl = document.getElementById('status');
            statusEl.style.display = 'none';
        }
    </script>
</body>
</html>

